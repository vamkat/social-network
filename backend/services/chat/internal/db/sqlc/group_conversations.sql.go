// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: group_conversations.sql

package sqlc

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const addMembersToGroupConversation = `-- name: AddMembersToGroupConversation :one
WITH convo AS (
    SELECT id
    FROM conversations
    WHERE group_id = $1
      AND deleted_at IS NULL
),
insert_members AS (
    INSERT INTO conversation_members (conversation_id, user_id)
    SELECT (SELECT id FROM convo), unnest($2::bigint[])
    ON CONFLICT (conversation_id, user_id) DO NOTHING
    RETURNING conversation_id
)
SELECT id FROM convo
`

type AddMembersToGroupConversationParams struct {
	GroupID pgtype.Int8
	UserIds []int64
}

// Find a conversation by group_id and insert the given user_ids into conversation_members.
// existing members are ignored, new members are added.
// Returns:
//
//	BIGINT          -- the conversation id
func (q *Queries) AddMembersToGroupConversation(ctx context.Context, arg AddMembersToGroupConversationParams) (int64, error) {
	row := q.db.QueryRow(ctx, addMembersToGroupConversation, arg.GroupID, arg.UserIds)
	var id int64
	err := row.Scan(&id)
	return id, err
}
